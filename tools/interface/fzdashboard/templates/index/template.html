<!DOCTYPE html>
<HTML>

<HEAD>
<noscript><meta http-equiv="refresh" content="0; url=/index-static.html" /></noscript>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel="icon" href="/favicon-32x32.png">
<link rel="stylesheet" href="/fz.css">
<link rel="stylesheet" href="/clock.css">
<link rel="stylesheet" href="/fzuistate.css">
<link rel="stylesheet" href="/fztask.css">
<link rel="stylesheet" href="/rightbar.css">
<style>
.mainpanel {
    display: grid;
    float: left;
    width: 87.5%;
    padding: 10px;
    rid-template-columns: 1fr;
}
.mainpanel-row {
    margin-bottom: 10px;
}
.rightpanel {
    float: right;
    width: 12.5%;
    padding: 10px;
}
/* clear floats after columns */
.bodyrow:after {
    content: "";
    display: table;
    clear: both;
}
.container {
    position: fixed;
    top: 120px;
    right: 0px;
}
/* Define the flashing sequence */
@keyframes warning-flash {
  0% { background-color: #ff0000; color: white; }    /* Bright Red */
  50% { background-color: #8b0000; color: #cccccc; } /* Dark Red */
  100% { background-color: #ff0000; color: white; }   /* Back to Bright */
}
/* The class that triggers the flash */
.flashing {
  animation: warning-flash 0.8s infinite; /* Cycles every 0.8 seconds forever */
  border: 2px solid white;
  box-shadow: 0 0 10px rgba(255, 0, 0, 0.8); /* Optional glow effect */
}
</style>
<TITLE>Formalizer Environment v2.0a - Top</TITLE>
</HEAD>
<BODY>
<script type="module" src="/fzuistate.js"></script>
<script type="text/javascript" src="/clock.js"></script>
<script type="text/javascript" src="/rightbar.js"></script>

<div class="bodyrow">
<div class="mainpanel">
<!-- <BODY onload="javascript:clockStart()"> -->
<H1>Formalizer Environment v2.0a - Top</H1>

<!-- <p id="clock"></p> -->
{{ button-sections }}

<hr>

<table><tbody><tr>
<td>Last remote backup: <span id="backupstate">??</span></td><td>Last external drive backup: ??</td><td>Last sync of accounts: ??</td>
</tr></tbody></table>

<hr>
</div> <!-- end of mainpanel -->

<div class="rightpanel">
<section class="container">
    <div class="timerBar">
        <div class="timerBarFill">
        </div>
        <div class="timerBarTextContainer">
            <div id="timerBarText" class="timerBarText"></div>
        </div>
    </div>
</section>
</div> <!-- end of rightpanel -->
</div> <!-- end of bodyrow -->

<script type="text/javascript" src="/stateoflog.js"></script>
<script type="text/javascript" src="/stateofbackup.js"></script>
<script>
const state_of_log = new logState(logstate_id="timerBarText");
const state_of_backup = new backupState('backupstate');
</script>
<script type="module">
function startWarning(btn_id) {
    document.getElementById(btn_id).classList.add('flashing');
}
function stopWarning(btn_id) {
    document.getElementById(btn_id).classList.remove('flashing');
}
const indicator_ids = {{ indicator-ids }};
async function getIndicatorsData(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    const data = await response.json();
    
    for (const indicator_id of indicator_ids) {
        if (data[indicator_id]['state']) {
            startWarning(indicator_id);
        } else {
            stopWarning(indicator_id);
        }
    }

  } catch (error) {
    console.error("Failed to fetch or parse JSON:", error);
  }
}
const IndicatorsDataUrl = '/formalizer/indicators.json';
setInterval(() => {
  getIndicatorsData(IndicatorsDataUrl);
}, 10000); // every 10 seconds
</script>
</BODY>

</HTML>
