<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Formalizer: Flask SSE example, modified by Randal A. Koene 2021-03-10</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="formalizer-logo-20200907-41x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Formalizer
   &#160;<span id="projectnumber">2.0.0-0.1</span>
   </div>
   <div id="projectbrief">The Formalizer System Support Environment</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Flask SSE example, modified by Randal A. Koene 2021-03-10 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p>Look ma, no dependencies! </p>
</blockquote>
<p>This repository is an example of how to perform <a href="https://www.wikiwand.com/en/Server-sent_events">server-sent events (SSE)</a> in Flask with no extra dependencies. Libraries such as <a href="https://github.com/singingwolfboy/flask-sse">flask-sse</a> are great, but they require having to use Redis or some other sort of <a href="https://www.wikiwand.com/en/Publish%E2%80%93subscribe_pattern">pubsub</a> backend. While this can be fine, I wanted to show that you can do SSE by only using Flask. The following instructions explain how to run the example. For more information on how this works, please see <a href="https://maxhalford.github.io/blog/flask-sse-no-deps">the accompanying blog post</a>.</p>
<h2>To Test</h2>
<p>You're going to need 3 terminal sessions plus a test page open on any browser you intend to test to run this example in it's entirety. The first will run the server, the second will listen to events, and the third will trigger events. You may also open an additional terminal if you want to add another listener. In fact, having multiple listeners is a good test to check that a single message is correctly dispatched once to each listener.</p>
<p>In the first terminal, create a virtual environment, activate it, and install the necessary requirements.</p>
<div class="fragment"><div class="line">python3 -m venv env</div>
<div class="line">source env/bin/activate</div>
<div class="line">pip install -r requirements.txt</div>
</div><!-- fragment --><p>Next, run the server.</p>
<div class="fragment"><div class="line">export FLASK_APP=fztask-server.py</div>
<div class="line">export FLASK_ENV=development</div>
<div class="line">flask run</div>
</div><!-- fragment --><p>In the second terminal, listen for updates.</p>
<div class="fragment"><div class="line">source env/bin/activate</div>
<div class="line">python fztask-client.py</div>
</div><!-- fragment --><p>Open any browsers you wish to test to the <code>test.html</code> page. This can be a URL such as <code><a href="file:///home/randalk/src/formalizer/core/fztask-server/test.html">file:///home/randalk/src/formalizer/core/fztask-server/test.html</a></code>. Or, you can copy the <code>test.html</code> file to <code>/var/www/html/formalizer/</code> and load that page as <code><a href="http://localhost/formalizer/test.html">http://localhost/formalizer/test.html</a></code>. Or, you can open a browser on another computer that can reach the same network, for example, <code><a href="http://morpheus.local/formalizer/test.html">http://morpheus.local/formalizer/test.html</a></code>.</p>
<p>Finally, in the third terminal, run the <code>fztaskAPI.py</code> script.</p>
<div class="fragment"><div class="line">source env/bin/activate</div>
<div class="line">python fztaskAPI.py</div>
</div><!-- fragment --><p>This will run an infinite loop which sends a GET request to the <code>/ping</code> route every second. This in turn will trigger an event which will be displayed in the listening terminal. You should see a new <code>pong</code> message being displayed every second or so.</p>
<p>Once you know that the ping-pong test is working then you can go ahead and implement signals (by importing <code>fztaskAPI.py</code>) and responses (as in <code>fztaskAPI.js</code>) to actual Task Chunk events such as TC_start and TC_end. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
